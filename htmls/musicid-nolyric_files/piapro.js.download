$(function () {
    $.cookie.defaults = { path: '/', expires: 365 };
    /* TOPへ戻る */
    $('#to_top a').click(function () {
        $('html,body').animate({ scrollTop: $($(this).attr('href')).offset().top }, 'slow', 'swing');
        return false;
    })
    /* 検索 */
    var views = {ic_snd: 'audio', ic_ill: 'image', ic_txt_normal: 'text', ic_3dm: '3dm', ic_tag: 'tag', ic_clb: 'collabo', ic_user: 'user'};
    var my_view = get_cookie('search_view');
    $.each(views, function (ic_cls, view) {
        if (my_view == view) {
            $('.selectbox img').attr('class', 'icons ' + ic_cls);
            $('#_form_search input[name="view"]').val(view);
            $('#_from_search_advanced input[name="view"]').val(view);
            return false;
        }
    });
    $('#_form_search input[type="button"]').click(function () {
        $('#_form_search').submit();
    });
    $('#_form_search').submit(function () {
        var $keyword = $('#_form_search input[name="keyword"]');
        var keyword = $.trim($keyword.val());
        $keyword.val(keyword);
        if (!keyword.length) {
            return false;
        }
        set_cookie('search_view', $('#_form_search input[name="view"]').val());
        return true;
    });
    $('.selectbox').click(function () {
        $('.pulldownbox').toggle();
        return false;
    });
    $('.pulldownbox a').click(function () {
        var $img = $(this).find('img');
        var $selimg = $('.selectbox img');
        $selimg.attr('class', 'icons');
        $.each(views, function (ic_cls, view) {
            if ($img.hasClass(ic_cls)) {
                $selimg.addClass(ic_cls);
                $('#_form_search input[name="view"]').val(view);
                $('#_from_search_advanced input[name="view"]').val(view);
            }
        });
        $('.pulldownbox').hide();
        return false;
    });
    $('#_search_advanced_pulldown').click(function () {
        $('#_search_advanced_box').toggle();
        return false;
    });
    $('#message_pulldown_toggle').click(function () {
        $('#message_pulldown_box').toggle();
        $('#_header_pmenu_etc').hide();
        return false;
    });
    $('#_from_search_advanced').submit(function () {
        var $keyword = $('#_form_search input[name="keyword"]');
        var keyword = $.trim($keyword.val());
        $keyword.val(keyword);
        if (!keyword.length) {
            return false;
        }
        set_cookie('search_view', $('#_form_search input[name="view"]').val());
        $('#_from_search_advanced input[name="keyword"]').val(keyword);
        return true;
    });
    $('#_from_search_advanced input[type="button"]').click(function () {
        $('#_from_search_advanced').submit();
    });
    $('#_search_advanced_license').click(function () {
        if ($(this).attr('checked')) {
            $('#_block_search_advanced_license').show();
        } else {
            $('#_block_search_advanced_license').hide();
        }
    });
    $('#_gnav_cont').hover(
        function () {
            $('#_header_pmenu_cont').stop(true, true).slideDown(100);
        },
        function () {
            $('#_header_pmenu_cont').stop(true, true).slideUp(100);
        }
    );
    $('#_gnav_collabo').hover(
        function () {
            $('#_header_pmenu_collabo').stop(true, true).slideDown(100);
        },
        function () {
            $('#_header_pmenu_collabo').stop(true, true).slideUp(100);
        }
    );
    $('#_gnav_start').hover(
        function () {
            $('#_header_pmenu_start').stop(true, true).slideDown(100);
        },
        function () {
            $('#_header_pmenu_start').stop(true, true).slideUp(100);
        }
    );
    $('#_btn_menu_etc').click(function () {
        $('#_header_pmenu_etc').slideToggle(100);
        $('#message_pulldown_box').hide();
        return false;
    });
    $('#_btn_menu_info').click(function () {
        $('#_header_pmenu_info').slideToggle(100);
        return false;
    });
    $(document).mouseup(function (e) {
        var $target = $(e.target);
        if (!$target.closest('.selectbox,.pulldownbox').size()) {
            $('.pulldownbox').hide();
        }
        if (!$target.closest('#_search_advanced_pulldown,#_search_advanced_box,input[name="keyword"]').size()) {
            $('#_search_advanced_box').hide();
        }
        if (!$target.closest('#_pmenu_box_etc').size()) {
            $('#_header_pmenu_etc').hide();
        }
        if (!$target.closest('#_pmenu_box_info').size()) {
            $('#_header_pmenu_info').hide();
        }
    });
});

function get_cookie(cookie_name) {
    var c_array = document.cookie.split(';');
    var cookie_value = null;
    for (i = 0; i < c_array.length; i++) {
        var c = c_array[i].split('=');
        c[0] = c[0].replace(' ', '');
        if (c[0] == cookie_name) {
            cookie_value = c[1];
            break;
        }
    }
    return cookie_value;
}

function set_cookie(cookie_name, cookie_value) {
    document.cookie = cookie_name + '=' + cookie_value + '; expires=Tue, 31-Dec-2030 23:59:59; path=/; ';
}
